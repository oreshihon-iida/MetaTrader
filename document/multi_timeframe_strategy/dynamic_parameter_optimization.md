# 動的パラメータ調整と複数時間足分析の最適化

## 概要

本ドキュメントでは、MetaTrader FX取引システムにおける動的パラメータ調整と複数時間足分析の最適化について説明します。これらの機能は、市場環境の変化に適応し、より高いパフォーマンスを実現するために実装されました。

## 1. 市場レジーム検出

### 実装内容

市場は主に以下の3つのレジームに分類されます：

1. **トレンド相場**：一定方向への持続的な価格変動
2. **レンジ相場**：一定範囲内での価格変動
3. **高ボラティリティ相場**：大きな価格変動が頻繁に発生

これらのレジームを検出するために、以下の指標を使用しています：

- **ADX（Average Directional Index）**：トレンドの強さを測定
- **ATR比率**：現在のボラティリティと過去のボラティリティの比較

レジーム判定基準：
- トレンド相場: ADX > 25
- レンジ相場: ADX < 20 かつ ATR比率 < 1.1
- 高ボラティリティ相場: ATR比率 > 1.3

### 利点

- 市場環境に応じた戦略の適応
- 不適切な市場環境でのトレードを回避
- 各レジームに最適化されたパラメータの使用

## 2. 動的時間足重み付け

### 実装内容

市場レジームに基づいて、異なる時間足の重要度を動的に調整します：

1. **トレンド相場**：
   - 5分足: 1.0
   - 15分足: 2.0
   - 30分足: 3.0
   
   長い時間足を重視してトレンドの方向性を確認

2. **レンジ相場**：
   - 5分足: 3.0
   - 15分足: 1.5
   - 30分足: 0.5
   
   短い時間足を重視して小さな価格変動を捉える

3. **高ボラティリティ相場**：
   - 5分足: 1.5
   - 15分足: 3.0
   - 30分足: 1.5
   
   中間の時間足を重視して適度なフィルタリングを行う

### 利点

- 市場環境に最適な時間足の組み合わせを自動選択
- 不要なノイズの除去と重要なシグナルの強調
- 複数時間足の確認による偽シグナルの削減

## 3. ボラティリティに基づくパラメータ調整

### 実装内容

市場のボラティリティに応じて、RSI閾値などのテクニカル指標パラメータを動的に調整します：

1. **高ボラティリティ時**（ATR比率 > 1.2）：
   - RSI上限: +5ポイント（例：55 → 60）
   - RSI下限: -5ポイント（例：45 → 40）
   
   閾値を広げて過剰なシグナル生成を抑制

2. **低ボラティリティ時**（ATR比率 < 0.8）：
   - RSI上限: -3ポイント（例：55 → 52）
   - RSI下限: +3ポイント（例：45 → 48）
   
   閾値を狭めて少ない価格変動でもシグナルを生成

### 利点

- ボラティリティに応じた適切なシグナル生成
- 市場環境の変化に自動的に適応
- 過剰トレードと機会損失のバランス最適化

## 4. 時間帯に基づくパラメータ調整

### 実装内容

異なる市場セッションに対して最適化されたパラメータを適用します：

1. **東京セッション**（UTC 0:00-6:00）：
   - RSI上限: 60
   - RSI下限: 40
   - ボリンジャーバンド偏差: 1.8

2. **ロンドンセッション**（UTC 8:00-16:00）：
   - RSI上限: 55
   - RSI下限: 45
   - ボリンジャーバンド偏差: 1.6

3. **NYセッション**（UTC 13:00-21:00）：
   - RSI上限: 58
   - RSI下限: 42
   - ボリンジャーバンド偏差: 1.7

4. **オーバーラップセッション**（UTC 13:00-16:00）：
   - RSI上限: 53
   - RSI下限: 47
   - ボリンジャーバンド偏差: 1.5

### 利点

- 各市場セッションの特性に合わせたパラメータ最適化
- 時間帯による価格変動パターンの違いに対応
- 高い勝率が期待できる時間帯での取引強化

## 5. ポジションサイズの動的調整

### 実装内容

市場レジームと勝率に基づいてポジションサイズを動的に調整します：

1. **市場レジームに基づく調整**：
   - トレンド相場: 通常サイズ（1.0倍）
   - レンジ相場: 縮小サイズ（0.8倍）
   - 高ボラティリティ相場: 大幅縮小サイズ（0.7倍）

2. **連続勝利に基づく調整**：
   - 連続勝利ごとに20%ずつ増加
   - 勝率50%以上: 最大5倍まで増加可能
   - 勝率50%未満: 最大2倍まで増加可能

3. **連続損失に基づく調整**：
   - 連続損失が3回以上: 50%に削減

### 利点

- リスク管理の強化
- 好調時の利益最大化
- 不調時の損失最小化
- 市場環境に応じたリスク調整

## 期待される改善

| 指標 | 現状 | 目標 |
|------|------|------|
| 勝率 | 30% | 40%以上 |
| プロフィットファクター | 1.09 | 1.8以上 |
| 純利益 | 42.43 | 200以上 |

## 今後の課題

1. **パラメータの最適化**：
   - 各市場レジームに対するパラメータの微調整
   - 時間帯別パラメータの最適化

2. **レジーム検出の精度向上**：
   - 追加指標の導入（例：ボリンジャーバンド幅の変化率）
   - 機械学習アルゴリズムの検討

3. **複数時間足分析の拡張**：
   - 1時間足、4時間足データの活用
   - 時間足間の相関関係の分析

4. **季節性分析の導入**：
   - 曜日効果の分析と活用
   - 月次パターンの検出と活用
