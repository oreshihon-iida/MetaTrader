# サポート/レジスタンスレベル検出アルゴリズム改善結果

## 1. 改善内容

サポート/レジスタンスレベル検出アルゴリズムに以下の改善を実装しました：

### 1.1 第1版の改善点

1. **アダプティブなパラメータ設定**
   - ATRを使用して市場ボラティリティを測定
   - ボラティリティに応じてパラメータを動的に調整

2. **改良されたクラスタリング手法**
   - DBSCAN風のクラスタリングアルゴリズム
   - 価格レベルの「強度」を考慮した重み付き平均

3. **複数時間足分析**
   - 15分足と1時間足のサポート/レジスタンスレベルを統合
   - 大きな時間足のレベルを優先的に考慮

4. **サポート/レジスタンス戦略の実装**
   - バウンス（反発）戦略
   - ブレイクアウト（突破）戦略
   - RSIとの組み合わせによるフィルタリング

### 1.2 第2版の改善点

1. **価格アクションパターンの導入**
   - ピンバー、エンゲルフィングなどのパターン検出
   - パターンが確認された場合のみシグナルを生成

2. **トレンド強度の評価**
   - 複数の移動平均（20/50/100期間）の配列を分析
   - トレンド強度に応じてシグナルをフィルタリング

3. **レベル強度の時間減衰**
   - 時間減衰係数（0.9）を導入し、最近のタッチに高い重みを付与
   - 価格の滞留時間も強度計算に加味

4. **RSIフィルタリングの最適化**
   - RSIの閾値を調整（30/70→45/55）
   - RSIの傾きも考慮したフィルタリング

5. **リスク/リワード比の改善**
   - 損切り/利確比率の調整（1:1.5→1:2.5）
   - レベルの強度に応じて損切り/利確幅を動的に調整

6. **日次シグナル制限**
   - 1日あたりの最大シグナル数を制限（2）
   - 市場環境に応じた閾値の動的調整

## 2. パフォーマンス比較

### 2.1 2000年のバックテスト結果

| 指標 | 改善前 | 第1版 | 第2版 |
|------|--------|-------|-------|
| 勝率 | 39.62% | 36.92% | 36.92% |
| プロフィットファクター | 1.01 | 0.99 | 0.99 |
| 総トレード数 | - | 65 | 65 |
| 総利益 | - | -6円 | -5.65円 |
| 最大ドローダウン | - | - | - |

### 2.2 2001年のバックテスト結果

| 指標 | 改善前 | 第1版 | 第2版 |
|------|--------|-------|-------|
| 勝率 | 45.24% | 42.86% | 42.86% |
| プロフィットファクター | 1.21 | 1.03 | 1.03 |
| 総トレード数 | - | 105 | 105 |
| 総利益 | - | 6円 | 6.45円 |
| 最大ドローダウン | - | - | - |

## 3. 戦略別パフォーマンス

第1版のテスト結果から、以下の戦略パターンが確認されました：

| 戦略 | 特徴 |
|------|------|
| Support/Resistance_ResistanceBreak | レジスタンスブレイクアウト戦略（最も多く使用） |
| Support/Resistance_H1_ResistanceBounce | 1時間足レジスタンスからの反発戦略 |
| Support/Resistance_H1_SupportBounce | 1時間足サポートからの反発戦略 |

## 4. 分析と考察

第1版の実装では、目標としていた勝率70%、プロフィットファクター2.0以上には達していませんでした。以下の点が課題として考えられます：

1. **シグナル生成の精度**：
   - 現在のRSIフィルタリング（30以下で買い、70以上で売り）が厳しすぎる可能性
   - バウンス/ブレイクアウト判定の閾値調整が必要
   - トレンド方向の考慮が不十分

2. **サポート/レジスタンスレベルの重要度評価**：
   - 現在の「強度」計算が十分に機能していない可能性
   - 過去のタッチ回数だけでなく、最近のタッチに重み付けが必要
   - 価格の滞留時間を考慮していない

3. **複数時間足の統合方法**：
   - 単純な結合ではなく、時間足間の確認（コンファメーション）が必要
   - 15分足と1時間足の優先順位付けの改善
   - 時間足間の矛盾するシグナルの処理

4. **市場環境への適応性**：
   - 異なる市場環境（トレンド/レンジ）に対する適応が不十分
   - ボラティリティに応じた動的なパラメータ調整の精度向上が必要

## 5. 第2版での改善アプローチ

第2版では、以下のアプローチで上記の課題に対応しました：

1. **市場環境の認識**：
   - 複数の移動平均（20/50/100期間）を使用してトレンド強度を計算
   - トレンド強度に応じて戦略を選択（強いトレンドではブレイクアウト、弱いトレンドではバウンス）
   - ボラティリティに応じて閾値を動的に調整

2. **シグナルの質の向上**：
   - 価格アクションパターン（ピンバー、エンゲルフィング）による確認
   - RSIの絶対値と傾きの両方を考慮
   - 複数の確認要素が揃った場合のみシグナル生成

3. **リスク管理の最適化**：
   - レベルの強度に応じて損切り/利確幅を動的に調整
   - 1日あたりの最大シグナル数を制限（2）
   - リスク/リワード比の改善（1:2.5）

4. **複数時間足の確認**：
   - 15分足と1時間足のレベルが近接している場合のみトレード
   - 大きな時間足のトレンド方向に沿ったトレードのみを許可
   - 複数時間足のシグナルが一致する場合、より強いシグナルとして扱う

## 6. 結論と今後の展望

サポート/レジスタンスレベル検出アルゴリズムの改善では、目標としていたパフォーマンスには達しませんでした。むしろ、2000年と2001年のバックテスト結果は若干の性能低下を示しています。第2版の戦略でも、パフォーマンスの大幅な向上は見られませんでした。

この結果から、以下の点が明らかになりました：

1. **サポート/レジスタンスレベルの検出精度**：
   - 現在のアルゴリズムでは、真に重要なレベルを特定できていない可能性がある
   - 価格の反応が強いレベルをより正確に特定する手法が必要

2. **シグナル生成のタイミング**：
   - 単純な価格の接近だけでなく、より複雑な条件（価格アクションパターン、ボリュームなど）の組み合わせが必要
   - エントリータイミングの最適化が重要

3. **市場環境の適応性**：
   - 異なる市場環境（トレンド/レンジ）に応じた戦略の切り替えが必要
   - 市場の状態を正確に判断するメカニズムの改善

第2版の戦略では、以下の点に特に注力しましたが、期待した効果は得られませんでした：
- 価格アクションパターンの確認
- トレンド強度の評価と適応
- 複数時間足の確認による誤シグナルの削減
- レベル強度の時間減衰を考慮した重み付け

目標は引き続き、勝率70%以上、プロフィットファクター2.0以上の達成ですが、より根本的なアプローチの見直しが必要です。

## 7. 次のステップ

1. **機械学習の検討**：
   - サポート/レジスタンスレベルの重要度を学習するモデルの構築
   - 過去のデータから効果的なエントリーポイントを学習する手法の検討

2. **複合指標の開発**：
   - サポート/レジスタンスだけでなく、複数の指標を組み合わせた複合シグナルシステムの構築
   - ボリューム、マーケットセンチメント、時間帯特性などの追加要素の統合

3. **パラメータ最適化の自動化**：
   - 遺伝的アルゴリズムなどを用いた自動パラメータ最適化の実装
   - ウォークフォワードテストによる過学習の防止

4. **リスク管理の高度化**：
   - ポジションサイジングの動的調整
   - 市場環境に応じた損切り/利確レベルの最適化

5. **既存戦略との統合**：
   - 東京レンジ・ロンドンブレイクアウト戦略やボリンジャーバンド＋RSI戦略との組み合わせ
   - 戦略間の相関性分析と最適な組み合わせの検討
