# パラメータ最適化による複合指標・リスク管理強化版戦略の改善提案

## 1. 現状の課題

2024-2025年のデータを使用した比較分析の結果、複合指標・リスク管理強化版戦略には以下の課題が明らかになりました：

1. **トレード数の不足**：
   - 2年間で合計3トレードのみ（元の戦略は10トレード）
   - 特に2025年では1トレードのみ

2. **勝率の低下**：
   - 全体勝率が40.00%から33.33%に低下
   - 2024年では両戦略とも0%の勝率

3. **目標未達成**：
   - 目標：勝率70%以上、プロフィットファクター2.0以上
   - 現状：勝率33.33%、プロフィットファクター0.37

一方で、純利益は-40.92から6.47へと改善し、2025年では100%の勝率とプロフィットファクター無限大を達成しています。これは、複合指標とリスク管理の強化が正しい方向性であることを示唆していますが、トレード数の増加と全体的な勝率の向上が必要です。

## 2. パラメータ最適化提案

### 2.1 シグナル生成条件の緩和

トレード数を増やすために、以下のパラメータ調整を提案します：

#### 2.1.1 複合指標のパラメータ調整

| パラメータ | 現在の値 | 提案値 | 理由 |
| --- | --- | --- | --- |
| トレンド強度指標閾値 | -0.3 | -0.5 | より多くのトレンド環境でのシグナル生成を可能にする |
| VAO上限閾値 | 0.5 | 0.3 | オーバーボート判定の緩和 |
| VAO下限閾値 | -0.5 | -0.3 | オーバーソールド判定の緩和 |
| MTCI閾値 | ±0.3 | ±0.2 | 複数時間足での確認条件の緩和 |
| 必要確認指標数 | 2/3 | 1/3 | 少なくとも1つの指標が確認できれば取引を許可 |

#### 2.1.2 時間足の重み付け調整

| 時間足 | 現在の重み | 提案値 | 理由 |
| --- | --- | --- | --- |
| 15分足 | 1.0 | 1.5 | 短期的なシグナルの重要性を高める |
| 1時間足 | 2.0 | 2.5 | 中期的なシグナルの重要性を維持 |
| 4時間足 | 3.0 | 2.0 | 長期的なシグナルの重要性を相対的に下げる |

#### 2.1.3 RSIパラメータの調整

| パラメータ | 現在の値 | 提案値 | 理由 |
| --- | --- | --- | --- |
| RSI上限 | 75 | 80 | オーバーボート判定の緩和 |
| RSI下限 | 25 | 20 | オーバーソールド判定の緩和 |

### 2.2 リスク管理パラメータの調整

リスク管理を最適化するために、以下のパラメータ調整を提案します：

#### 2.2.1 ポジションサイジングの調整

| パラメータ | 現在の値 | 提案値 | 理由 |
| --- | --- | --- | --- |
| 基本ロットサイズ | 0.01 | 0.01 | 変更なし（リスク管理の基本） |
| 最大リスク率 | 2% | 2% | 変更なし（リスク管理の基本） |
| 品質係数範囲 | 0.5-1.5 | 0.7-1.5 | 最小値を引き上げてポジションサイズを増加 |
| ボラティリティ係数範囲 | 0.5-1.5 | 0.7-1.3 | 範囲を狭めて安定性を向上 |

#### 2.2.2 損切り・利確レベルの調整

| パラメータ | 現在の値 | 提案値 | 理由 |
| --- | --- | --- | --- |
| 基本SLピップス | 10.0 | 8.0 | 損失を抑制するために損切り幅を縮小 |
| 基本TPピップス | 20.0 | 20.0 | 変更なし |
| ATR乗数（SL） | 1.5 | 1.2 | 損切り幅を縮小してリスクを抑制 |
| ATR乗数（TP） | 2.0 | 2.2 | 利確幅を拡大して利益を最大化 |
| 最小R:R比 | 1.5 | 2.0 | リスク・リワード比を向上 |

#### 2.2.3 リスク制限の調整

| パラメータ | 現在の値 | 提案値 | 理由 |
| --- | --- | --- | --- |
| 最大ドローダウン制限 | 10% | 15% | より多くのトレード機会を確保 |
| 最大エクスポージャー | 20% | 25% | より多くのポジションを同時に保有可能に |
| 連続損失制限 | 3 | 4 | より多くのトレード機会を確保 |
| ドローダウン係数範囲 | 0.25-1.0 | 0.3-1.0 | 最小値を引き上げてポジションサイズを増加 |
| 連続損失係数範囲 | 0.5-1.0 | 0.6-1.0 | 最小値を引き上げてポジションサイズを増加 |

### 2.3 市場環境分類パラメータの調整

市場環境に応じたパラメータ調整を最適化するために、以下の変更を提案します：

#### 2.3.1 市場環境ごとのRSI閾値

| 市場環境 | 現在のRSI上限/下限 | 提案値 | 理由 |
| --- | --- | --- | --- |
| レンジ相場 | 75/25 | 70/30 | レンジ相場では中央値に近い閾値が効果的 |
| 上昇トレンド | 80/30 | 85/35 | 上昇トレンドではオーバーボート閾値を引き上げ |
| 下降トレンド | 70/20 | 65/15 | 下降トレンドではオーバーソールド閾値を引き下げ |
| 高ボラティリティ | 85/15 | 90/10 | 高ボラティリティでは極端な値を許容 |

#### 2.3.2 市場環境ごとのボリンジャーバンド乖離率

| 市場環境 | 現在のBB乖離率 | 提案値 | 理由 |
| --- | --- | --- | --- |
| レンジ相場 | 2.0 | 1.8 | レンジ相場では狭いバンド幅が効果的 |
| 上昇トレンド | 2.2 | 2.5 | トレンド相場では広いバンド幅が必要 |
| 下降トレンド | 2.2 | 2.5 | トレンド相場では広いバンド幅が必要 |
| 高ボラティリティ | 2.5 | 3.0 | 高ボラティリティでは非常に広いバンド幅が必要 |

## 3. 実装方法

提案したパラメータ最適化を実装するために、以下のファイルを修正します：

1. **src/indicators/composite_indicators.py**：
   - 複合指標の閾値を調整
   - 時間足の重み付けを変更

2. **src/risk_management/risk_manager.py**：
   - ポジションサイジングパラメータを調整
   - 損切り・利確レベルの計算方法を最適化
   - リスク制限パラメータを緩和

3. **src/strategies/composite_enhanced_strategy.py**：
   - シグナル確認条件を緩和（必要確認指標数を変更）
   - 市場環境分類パラメータを調整
   - RSIとボリンジャーバンドのパラメータを市場環境ごとに最適化

## 4. 検証方法

パラメータ最適化の効果を検証するために、以下のテストを実施します：

1. **2024-2025年のバックテスト**：
   - 最適化前後の戦略パフォーマンスを比較
   - トレード数、勝率、プロフィットファクター、純利益の変化を評価

2. **市場環境別のパフォーマンス分析**：
   - レンジ相場、トレンド相場、高ボラティリティ相場での戦略パフォーマンスを評価
   - 各環境でのパラメータ最適化の効果を検証

3. **感度分析**：
   - 各パラメータの変更がパフォーマンスに与える影響を評価
   - 最も感度の高いパラメータを特定し、さらなる最適化の方向性を決定

## 5. 期待される効果

提案したパラメータ最適化により、以下の効果が期待されます：

1. **トレード数の増加**：
   - 現在の3トレードから15-20トレードへの増加
   - より統計的に有意な結果の取得

2. **勝率の向上**：
   - 現在の33.33%から60-70%への向上
   - 目標の70%に近づける

3. **プロフィットファクターの向上**：
   - 現在の0.37から1.5-2.0への向上
   - 目標の2.0に近づける

4. **純利益の増加**：
   - 現在の6.47から30-50への増加
   - より安定した収益性の実現

## 6. 結論

複合指標・リスク管理強化版戦略は、純利益の改善という点で有効であることが示されていますが、トレード数の不足と勝率の低下が課題です。提案したパラメータ最適化により、これらの課題を解決し、目標である勝率70%以上、プロフィットファクター2.0以上の達成に近づけることが可能になると考えられます。

特に、シグナル生成条件の緩和と市場環境適応性の向上が重要であり、これらの最適化により、より多くのトレード機会を確保しつつ、高い勝率とプロフィットファクターを維持することが期待されます。
