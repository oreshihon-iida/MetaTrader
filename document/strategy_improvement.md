# サポート/レジスタンスレベル検出アルゴリズム改善計画

## 1. 現状分析

現在のサポート/レジスタンスレベル検出アルゴリズムは、以下のような特徴を持っています：

- スイングポイント検出（window_size: 10, swing_threshold: 0.0003）
- 距離閾値に基づくクラスタリング（cluster_distance: 0.0005）
- 最新の終値に最も近い3つのレベルを選択

現在のパフォーマンス指標：
- 勝率: 39.62%（2000年）、45.24%（2001年）
- プロフィットファクター: 1.01（2000年）、1.21（2001年）

## 2. 問題点

現在のアルゴリズムには以下の問題点があります：

1. **固定パラメータ**: 市場環境に関わらず同じパラメータを使用しているため、ボラティリティの変化に対応できない
2. **単純なクラスタリング**: 距離閾値のみに基づくクラスタリングでは、重要度の高いレベルを適切に特定できない
3. **単一時間足**: 15分足のみの分析で、より大きな時間足のサポート/レジスタンスレベルを考慮していない
4. **未活用**: 検出されたサポート/レジスタンスレベルが取引戦略に活用されていない

## 3. 改善策

### 3.1 アダプティブなパラメータ設定

- ATR（Average True Range）を使用して市場ボラティリティを測定
- ボラティリティに応じてスイングポイント検出の閾値とクラスタリングの距離閾値を動的に調整
- 高ボラティリティ環境では大きな閾値、低ボラティリティ環境では小さな閾値を使用

### 3.2 改良されたクラスタリング手法

- 単純な距離閾値ではなく、DBSCAN風のクラスタリングアルゴリズムを実装
- 価格レベルの「強度」（タッチ回数）を考慮した重み付き平均を計算
- より重要なサポート/レジスタンスレベルを優先的に抽出

### 3.3 複数時間足分析

- 15分足と1時間足のサポート/レジスタンスレベルを統合
- 大きな時間足のレベルを優先的に考慮
- 複数時間足の確認によるフィルタリング機能を実装

### 3.4 サポート/レジスタンス戦略の実装

- サポート/レジスタンスレベルからのバウンス（反発）を利用した取引戦略
- サポート/レジスタンスレベルのブレイクアウト（突破）を利用した取引戦略
- RSIとの組み合わせによるフィルタリング

## 4. 期待される効果

- 市場環境に適応したサポート/レジスタンスレベルの検出精度向上
- 重要度の高いレベルの優先的な抽出
- 複数時間足の確認による誤検出の削減
- サポート/レジスタンスレベルを活用した新しい取引戦略の追加

目標指標：
- 勝率: 70%以上
- プロフィットファクター: 2.0以上

## 5. 検証方法

- 改善されたアルゴリズムによるサポート/レジスタンスレベルの可視化
- 2000年と2001年のデータを使用したバックテスト
- パフォーマンス指標（勝率、プロフィットファクター）の比較
- 月別・戦略別のパフォーマンス分析
